<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Marios Yiannakou">
  <meta name="description" content="RaspberryPi Weather based Spotify Web-Player">
  <title>mario~ RaSpotify</title>

  <!-- ***** STYLESHEETS ***** -->
  <!-- FontAwsome CDN -->
  <link rel="stylesheet" href="static/fontawesome/css/all.css">
  <link rel="stylesheet" href="static/fontawesome/css/fontawesome.css">
  <!-- BootStrap CDN -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <!-- Slider CSS -->
  <link rel="stylesheet" href="static/css/roundslider.css">
  <!-- Custom CSS Styles -->
  <link rel="stylesheet" href="static/css/styles.css">
</head>

<body>
  <!-- Error messages -->
  <% if (error_msgs.length > 0) { %>
    <div class="alert alert-danger" role="alert">
      <h3>Erros:</h3>
      <ul>
      <% error_msgs.forEach(err => { %>
        <li>
          <%= err %>
        </li>
      <% }); %>
      </ul>
    </div>
  <% } %>

  <!-- Spotify Web Player -->
  <table id="spotify-web-player" class="table table-dark table-striped">
    <thead>
      <tr>
        <th colspan="3">
          <% if (username) { %>
            <h1 class="spotify-player-header"><i class="fab fa-spotify"></i> Spotify Web-Player (<%= username %>) </h1>
          <% } else { %>
            <h1 class="spotify-player-header"><i class="fab fa-spotify"></i> Spotify Web-Player</h1>
          <% } %>
        </th>
      </tr>
      <tr>
        <th class="table-col-3">Previous Track:</th>
        <th class="table-col-3">Currently Playing:</th>
        <th class="table-col-3">Upcoming Track:</th>
      </tr>
    </thead>
    <tbody>
      <!-- Thumbnails Row -->
      <tr>
        <td class="align-bottom">
          <img class="track-thumbnail" id="previous-track-thumb" alt="previous-track">
        </td>
        <td class="align-bottom">
          <img class="current-track-thumbnail" id="current-track-thumb"
              alt="current-track" src="<%= current_track_image %>">
        </td>
        <td class="align-bottom">
          <img class="track-thumbnail" id="upcoming-track-thumb" alt="upcoming-track">
        </td>
      </tr>
      <!-- Track Information Row -->
      <tr>
        <td class="spotify-information" id="previousTrack">Previous track name</td>
        <td class="spotify-information" id="currentTrack"><%= current_track_name %></td>
        <td class="spotify-information" id="upcomingTrack">Upcoming track name</td>
      </tr>
      <tr>
        <td class="spotify-information" id="previousTrackArtists">Previous track artists</td>
        <td class="spotify-information" id="currentTrackArtists"><%= current_track_artists %></td>
        <td class="spotify-information" id="upcomingTrackArtists">Upcoming track artists</td>
      </tr>
      <!-- Playback Controls -->
      <tr>
        <td></td>
        <td>
          <!-- Shuffle -->
          <form class="spotify-media-btn" action="/spotify_shuffle" method="POST">
            <% if ( shuffle ) { %>
            <button type="submit" class="btn btn-lg btn-success">
              <i class="fas fa-random"></i>
            </button>
            <% } else { %>
            <button type="submit" class="btn btn-lg btn-danger">
              <i class="fas fa-random"></i>
            </button>
            <% } %>
          </form>
          <!-- Skip to previous -->
          <form class="spotify-media-btn" action="/spotify_previous" method="POST">
            <button type="submit" class="btn btn-lg btn-success">
              <i class="fas fa-step-backward"></i>
            </button>
          </form>
          <!-- Play / Pause -->
          <form class="spotify-media-btn" action="/spotify_play_pause" method="POST">
            <button type="submit" class="btn btn-lg btn-success">
            <% if ( playing ) { %>
            <i class="fas fa-play-circle"></i>
            <% } else { %>
            <i class="fas fa-pause-circle"></i>
            <% } %>
            </button>
          </form>
          <!-- Skip to next -->
          <form class="spotify-media-btn" action="/spotify_next" method="POST">
            <button type="submit" class="btn btn-lg btn-success">
              <i class="fas fa-step-forward"></i>
            </button>
          </form>
          <!-- Repeat -->
          <form class="spotify-media-btn" action="/spotify_repeat" method="POST">
            <% if ( repeat === "track" || repeat === "context" ) { %>
            <button type="submit" class="btn btn-lg btn-success">
              <i class="fas fa-redo-alt"></i>
            </button>
            <% } else { %>
            <button type="submit" class="btn btn-lg btn-danger">
              <i class="fas fa-redo-alt"></i>
            </button>
            <% } %>
          </form>
        </td>
        <td></td>
      </tr>
    </tbody>
  </table>

  <!-- Recently Played Tracks -->
  <table class="table table-dark table-striped">
    <thead>
      <tr>
        <th colspan="5"><h3>Recently Played Tracks:</h3></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <% recentTracks.forEach(track => { %>
          <td class="recent-track-thumbnail-cell">
            <img class="recent-track-thumbnail" alt="recent-track"
                  src="<%= track.track.album.images[0].url %>">
          </td>
        <% }); %>
      </tr>
      <tr>
        <% recentTracks.forEach(track => { %>
          <td class="spotify-recent-col">
            <a href="<%= track.track.external_urls.spotify %>" target="_blank">
              <%= track.track.name %>
            </a>
          </td>
        <% }); %>
      </tr>
    </tbody>
  </table>

  <!-- SenseHAT Temperature and Humidity Readings -->
  <table id="weather-table" class="table table-striped table-dark">
    <thead>
      <tr>
        <th colspan="3">
          <h1 class="weather-header">
            Temperature and Humidity Data
            <a href="/weather" class="btn btn-sm btn-success">
              <i class="fas fa-redo-alt"></i> Refresh Data
            </a>
          </h1>
        </th>
      </tr>
      <% if (playlist) { %>
      <tr>
        <td colspan="3">
          <h3>
            Based on the latest weather reading of <b><%= weather[0].temperature %></b> degrees, we thought you might enjoy this:
          </h3>
          <img src="<%= playlist.img %>" alt="Playlist thumbnail" class="recent-track-thumbnail">
          <a href="<%= playlist.url %>" target="_blank"><h2><%= playlist.name %> by <%= playlist.owner %></h2></a>
        </td>
      </tr>
      <% } %>
      <tr>
        <th class="table-col-3">Time</th>
        <th class="table-col-3">Temperature</th>
        <th class="table-col-3">Humidity</th>
      </tr>
    </thead>
    <tbody>
      <% weather.forEach(item => { %>
      <tr>
        <td id="time"><%= item.time %></td>
        <td id="temp"><%= item.temperature %></td>
        <td id="humidity"><%= item.humidity %></td>
      </tr>
      <% }); %>
    </tbody>
  </table>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

</body>
</html>